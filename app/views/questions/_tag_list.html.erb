<% if @question == nil %>
<% @question = Question.where(slug: params[:id])[0] %>
<% end %>

<%@tag_array = Tag.where(question_id: @question.id).order(created_at: :asc)%>

<script>
$(document).ready(function() {

  <%if user_signed_in?
        @liked_tag = Opinion.where(user_id: current_user.id, question_id: @question.id)
        @liked_tag_array = Array.new()
        @liked_tag.each do |tagId|
          @liked_tag_array << Tag.where(question_id: @question.id, id: tagId.tag_id).first.label
        end
      else
        @liked_tag = Opinion.where(user_id: cookies[:guest], question_id: @question.id)
        @liked_tag_array = Array.new()
        @liked_tag.each do |tagId|
          @liked_tag_array << Tag.where(question_id: @question.id, id: tagId.tag_id).first.label
        end
      end
    %>

    <%if !@liked_tag_array.nil?%>
      <%@liked_tag_array.each do |tag|%>
        var index = 0
        for(index; index <= <%= @tag_array.length - 1%>; index++){
          if ($('.form-radio')[index].value == "<%= tag %>"){           
            $('.form-radio')[index].offsetParent.style.color = "#419BF9 ";
          }
        }
      <%end%>
    <%end%>

  $('.new-tag-submit').prop('disabled', true);

  $('#other').keyup(function() {
   inspectAllInputFields();
  });

  function inspectAllInputFields(){
     var count = 0;
     $('#other').each(function(i){
       if( $(this).val() === '') {
           count++;
        }
        if(count == 0){
          $('.new-tag-submit').prop('disabled', false);
        }else {
          $('.new-tag-submit').prop('disabled', true);
        }

    });
  }

  $('input[type=radio]').click(function () {
    if ($('.form-radio:checked')){
      $('.new-tag-submit').prop('disabled', false);
    }
  });
});

</script>

<% if @answer == nil %>
<% @answer = user_signed_in? ? @question.answers.build(user_id: current_user.id) : @question.answers.build(user_id: cookies[:guest]) %>
<% end %>

<div class="wrapper background-container">
  <div class="wrapper center-container">
    <div class="tag-prompt">

      <%= simple_form_for @answer,:url => {:action => "add_tag", :controller => "answers"}, class: "form-inline", role: "form", html: {novalidate: true}, :remote => true do |f| %>
      <!-- <div class="liner-title">What people say about this image:</div> -->

        <div class="options">
            <%if !@tag_array.nil?  %>

                <% @tag_array.each do |tag|%>
                <label class= "tag_button_collection" >
                  <% @tag_count = tag.counter %>
                  <%= f.radio_button :value, tag.label, :class=>"form-radio"%>
                  <%="#{tag.label}"%>
                  <progress class= "progress" value="<%=@tag_count%>" max="15" style="display: block; margin-top: 2.5px;"></progress>
                  <%if !@user_submitted_answer%>
                    <span class="tag-count">
                      <%= @tag_count %>
                    </span>
                  <% end %>
                </label>
                <%end%>
          <% end %>
        </div>
        <br>
        <div id="otherInputBox" >
            <%= hidden_field_tag 'question_id', @question.id %>
            <%= f.input(:options_for_collection, label: false,input_html:{value: nil, placeholder: "Add your own opinion to the list", class: "other-input-text", id:"other"}) %>
            <%= f.submit "Submit", class: "new-tag-submit" %>
        </div>
        <br>
                  <div id="view_map" style="display: block;"> 
                    <%= link_to "view map", remote: true, controller: "answers", action: "view_map" %>
                  </div>


      </div>
        <br>
      <% end %>


    </div>
  </div>
</div>
